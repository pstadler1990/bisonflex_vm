#include <stdio.h>
#include "vm.h"

e_vm context;

int main() {

	// let a = 42 : let b = 2*a : if(b>a) then b endif
	uint8_t bytes_in[] = {
			0x14, 0x40, 0x45, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	// PUSH 42
			0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	// PUSHG [0] ;a
			0x14, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	// PUSH 2
			0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	0x00,	// POPG [0] ;a
			0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	// MUL
			0x10, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,	// PUSHG [1] ;b
			0x11, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,	// POPG [1] ;b
			0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	// POPG [0]; a
			0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	// GT
			0x40, 0x00, 0x00, 0x00, 0x0B, 0xFF, 0xFF, 0xFF, 0xFF,	// JZ
			0x11, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,	// POPG [1] ;b
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	// -- eof --
	};

	e_vm_init(&context);

	e_vm_parse_bytes(&context, bytes_in,sizeof(bytes_in) / sizeof(uint8_t));

	return 0;
}