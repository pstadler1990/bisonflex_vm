#include <stdio.h>
#include "vm.h"

e_vm context;

int main() {

	// let a = 42 : if(a==42) then let b = 69 : if(b>a) then let c = 99-b : b endif endif
	uint8_t bytes_in[] = {
			0x14 ,	0x40 ,	0x45 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// PUSH 42
			0x10 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// PUSGH [0]	;a
			0x11 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// POPG [0]		;a
			0x14 ,	0x40 ,	0x45 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// PUSH 42
			0x20 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// EQ
			0x40 ,	0x0 ,	0x0 ,	0x0 ,	0x11 ,	0xFF ,	0xFF ,	0xFF ,	0xFF ,		// JZ [17]
			0x14 ,	0x40 ,	0x51 ,	0x40 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// PUSH 69
			0x12 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// PUSHL [0]	;b
			0x13 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// POPL [0]		;b
			0x11 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// POPG [0]		;a
			0x22 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// GT
			0x40 ,	0x0 ,	0x0 ,	0x0 ,	0x11 ,	0xFF ,	0xFF ,	0xFF ,	0xFF ,		// JZ [17]
			0x14 ,	0x40,	0x58 ,	0xC0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// PUSH 99
			0x13 ,	0x0,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// POPL [0] 	;b
			0x32 ,	0x0,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// SUB
			0x12 ,	0x0,	0x0 ,	0x0 ,	0x1 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// PUSHL [1]	;c
			0x13 ,	0x0,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// POPL [0]		;b
			0x0,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,	0x0 ,		// - EOF -
	};

	e_vm_init(&context);

	e_vm_parse_bytes(&context, bytes_in,sizeof(bytes_in) / sizeof(uint8_t));

	return 0;
}